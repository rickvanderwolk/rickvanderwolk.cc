<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bubble Klok</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: system-ui, -apple-system, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            background: linear-gradient(180deg, #0c1445, #0a2a4a, #0c3b5e);
            overflow: hidden;
        }
        .chart-container {
            width: 95vw;
            height: 90vh;
        }
    </style>
</head>
<body>
    <div class="chart-container">
        <canvas id="bubbleClock"></canvas>
    </div>

    <script>
        const ctx = document.getElementById('bubbleClock').getContext('2d');

        // Maak bubble pools voor elk tijdselement
        function createBubblePool(count, xCenter, xSpread, hue) {
            const bubbles = [];
            for (let i = 0; i < count; i++) {
                bubbles.push({
                    x: xCenter + (Math.random() - 0.5) * xSpread,
                    y: Math.random() * 120,
                    baseX: xCenter,
                    xSpread: xSpread,
                    r: 3 + Math.random() * 4,
                    speed: 0.4 + Math.random() * 0.4,
                    wobblePhase: Math.random() * Math.PI * 2,
                    wobbleSpeed: 0.001 + Math.random() * 0.002,
                    hue: hue + Math.random() * 15
                });
            }
            return bubbles;
        }

        // 3 pools: uren (max 12), minuten (max 60), seconden (max 60)
        const hourPool = createBubblePool(12, 20, 12, 210);
        const minutePool = createBubblePool(60, 50, 20, 175);
        const secondPool = createBubblePool(60, 80, 12, 155);

        function updateBubbles(pool, activeCount) {
            pool.forEach((b, i) => {
                const isActive = i < activeCount;

                if (isActive) {
                    // Beweeg omhoog
                    b.y -= b.speed;

                    // Recycle: als boven scherm, start weer onderaan
                    if (b.y < -5) {
                        b.y = 105 + Math.random() * 10;
                        b.x = b.baseX + (Math.random() - 0.5) * b.xSpread;
                    }

                    // Wobble horizontaal
                    b.x = b.baseX + Math.sin(Date.now() * b.wobbleSpeed + b.wobblePhase) * (b.xSpread / 2);
                }
            });
        }

        function getVisibleBubbles(pool, activeCount, alphaBase) {
            return pool
                .slice(0, activeCount)
                .filter(b => b.y >= 0 && b.y <= 100)
                .map(b => ({
                    x: b.x,
                    y: b.y,
                    r: b.r,
                    hue: b.hue,
                    alpha: alphaBase
                }));
        }

        const clock = new Chart(ctx, {
            type: 'bubble',
            data: {
                datasets: [{
                    data: [],
                    backgroundColor: [],
                    borderColor: [],
                    borderWidth: 2
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                animation: false,
                plugins: {
                    legend: { display: false },
                    tooltip: { enabled: false }
                },
                scales: {
                    x: { min: 0, max: 100, display: false },
                    y: { min: 0, max: 100, display: false, reverse: true }
                }
            }
        });

        function animate() {
            const now = new Date();
            const hours = now.getHours() % 12;
            const minutes = now.getMinutes();
            const seconds = now.getSeconds();

            // Update alle pools
            updateBubbles(hourPool, hours);
            updateBubbles(minutePool, minutes);
            updateBubbles(secondPool, seconds);

            // Verzamel zichtbare bubbles
            const allBubbles = [
                ...getVisibleBubbles(hourPool, hours, 0.85),
                ...getVisibleBubbles(minutePool, minutes, 0.7),
                ...getVisibleBubbles(secondPool, seconds, 0.75)
            ];

            clock.data.datasets[0].data = allBubbles.map(b => ({ x: b.x, y: b.y, r: b.r }));
            clock.data.datasets[0].backgroundColor = allBubbles.map(b =>
                `hsla(${b.hue}, 80%, 55%, ${b.alpha})`
            );
            clock.data.datasets[0].borderColor = allBubbles.map(b =>
                `hsla(${b.hue}, 80%, 70%, ${b.alpha + 0.1})`
            );

            clock.update('none');
            requestAnimationFrame(animate);
        }

        animate();
    </script>
</body>
</html>
